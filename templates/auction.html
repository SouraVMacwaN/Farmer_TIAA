{% extends 'base.html' %}

{% load crispy_forms_tags %}

{% block title %} auctions | {{title}} {% endblock %}

{% block content %}
<div class="container">
    <h1 class='h3 mb-4 text-gray-800'>
        <span>{{ auction.title }}</span>
    </h1>
    <hr>
    <h6>
        <span class='text-muted'>
            Category: <span class='text-primary'>{{ auction.category }}</span>
        </span> &nbsp; | &nbsp; 
        <span class='text-muted'>
            Listed by: <span class='text-primary'>{{ auction.creator }}</span>
        </span> &nbsp; | &nbsp;
        <span class='text-muted'>
            Created on {{ auction.date_created}}
        </span>
    </h6>
    <hr>

    <!-- Product price -->
    <h4 class='fw-bolder mb-4'>
        {% if auction.current_bid %}
            Kshs. {{auction.current_bid}}
        {% else %}
            Kshs. {{auction.starting_bid}}
        {% endif %}
    </h4>

    <!-- Watchlist -->
    <div>
        <a class='btn btn-outline-success mt-auto mb-3' href="{% url 'watchlist_edit' auction.id 'auction_detail' %}">
            {% if auction.is_watched %}
                Remove from Watchlist
            {% else %}
                Add to Watchlist
            {% endif %}
        </a>
    </div>
    
    {% if auction.creator == user and auction.active %}
    <div class="row">
        <div class="col-md-6 how-img">
            {% for image in images %}
            <img src="{{image.image.url}}" class="img-rounded" alt="Product Image"/>
            {% empty %}
            <img src="static/images/no_image.png" class="img-rounded" alt="Product Image"/>
            {% endfor %}
        </div>        
        <div class="col-md-6">
            <h4>{{auction.title}}</h4>
            <p class="text-muted">
                {{auction.description}}
            </p>
            <a href="" class="btn btn-danger">Close Auction</a>
        </div>
    </div>
    {% elif auction.creator != user and auction.active %}
    <div class="row">
        <div class="col-md-6 how-img">
            {% for image in images %}
            <img src="{{image.image.url}}" class="img-rounded" alt=""/>
            {% empty %}
            <img src="static/images/no_image.png" class="img-rounded" alt=""/>
            {% endfor %}
        </div>        
        <div class="col-md-6">
            <h4>{{auction.title}}</h4>
            <p class="text-muted">
                {{auction.description}}
            </p>
        </div>
    </div>
    {% endif %}

    {% if auction.creator != user and auction.active %}
        {% if auction.current_bid %}
        <h4 class="mt-4">Current Price: {{auction.current_bid}}</h4>
        {% else  %}
        <h4 class="mt-4">Starting Price: {{auction.current_bid}}</h4>
        {% endif %}
    {% endif %}

    <p>
        {% if auction.current_bid is None %}
            {% if auction.creator != user %}
            <div class="alert alert-secondary col-md-6" role="alert">
                Place your bid on this auction.
            </div>
            {% endif %}
        {% elif auction.buyer is not None %}
            {% if auction.creator == user %}
                <div class="alert alert-secondary" role="alert">
                    The item sold to <strong>{{ auction.buyer }}</strong> for <strong>&euro;{{ auction.current_bid }}</strong>.
                </div>
            {% elif auction.buyer == user %}
                <div class="alert alert-success" role="alert">
                    Congratulations! Your bid won on {{auction.title}}
                </div>
            {% else %}
                <div class="alert alert-warning" role="alert">
                    The item is sold.
                </div>
            {% endif %}
        {% endif %}
    </p>

    {% if error_min_value %}
    <p>
        {% if auction.current_bid %}
            <div class="alert alert-warning" role="alert">
                Your bid must be greater than {{auction.current_bid|default:auction.starting_bid}}
            </div>
        {% else  %}
            <div class="alert alert-warning" role="alert">
                Your bid must be greater or equal to {{auction.current_bid | default:auction.starting_bid}}
            </div>
        {% endif %}
    </p>
    {% endif %}

    <form action="{% url 'bid' auction.id %}" method="post">
        {% csrf_token %}
        <div class="form-row">
          <div class="form-group col-md-6">
            <!-- <label for="inputEmail4">Bid:</label> -->
            {{bid_form |crispy}}
          </div>
        </div>
        <div class="form-group">
            <button type="submit" class="btn btn-primary">Submit</button>
            <button type="reset" class="btn btn-danger">Clear</button>
        </div>
    </form>
</div>
{% endblock %}